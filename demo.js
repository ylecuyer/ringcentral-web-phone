/*! For license information please see demo.js.LICENSE.txt */
(()=>{var e,o={"./demo/index.js":(e,o,n)=>{const t=n("./node_modules/sip.js/lib/index.js"),l=n("./node_modules/jquery/dist/jquery.js");window.jQuery=l,window.SIP=t,l((()=>{const e=n("./node_modules/@ringcentral/sdk/lib/SDK.js").SDK,o=n("ringcentral-web-phone")||window.RingCentral.WebPhone;let t=null,r=null,a=null,i=0,c=null,s=null,d="";const g=l("#app"),u=l("#template-login"),m=l("#template-auth-flow"),p=l("#template-call"),f=l("#template-incoming"),h=l("#template-accepted"),v=document.getElementById("remoteVideo"),b=document.getElementById("localVideo");let w=!0,y="";function S(e){return l(e.html())}function k(e,o,n,t,l,a,c){return i=c,localStorage.setItem("webPhoneServer",e||""),localStorage.setItem("webPhoneclientId",o||""),localStorage.setItem("webPhoneclientSecret",n||""),localStorage.setItem("webPhoneLogin",t||""),localStorage.setItem("webPhoneExtension",l||""),localStorage.setItem("webPhonePassword",a||""),localStorage.setItem("webPhoneLogLevel",i||0),r.get("/restapi/v1.0/account/~/extension/~").then((e=>e.json())).then((e=>(s=e,console.log("Extension info",s),r.post("/restapi/v1.0/client-info/sip-provision",{sipInfo:[{transport:"WSS"}]})))).then((e=>e.json())).then(I).then(E).catch((e=>{console.error("Error in main promise chain"),console.error(e.stack||e)}))}function I(e){return a=new o(e,{enableDscp:!0,clientId:localStorage.getItem("webPhoneclientId"),audioHelper:{enabled:!0,incoming:"audio/incoming.ogg",outgoing:"audio/outgoing.ogg"},logLevel:parseInt(i,10),appName:"WebPhoneDemo",appVersion:"1.0.0",media:{remote:v,local:b},enableQos:!0,enableMediaReportLogging:!0}),window.webPhone=a,a.userAgent.audioHelper.setVolume(.3),a.userAgent.on("invite",P),a.userAgent.on("connecting",(()=>{console.log("UA connecting")})),a.userAgent.on("connected",(()=>{console.log("UA Connected")})),a.userAgent.on("disconnected",(()=>{console.log("UA Disconnected")})),a.userAgent.on("registered",(()=>{console.log("UA Registered")})),a.userAgent.on("unregistered",(()=>{console.log("UA Unregistered")})),a.userAgent.on("registrationFailed",(function(){console.log("UA RegistrationFailed",arguments)})),a.userAgent.on("message",(function(){console.log("UA Message",arguments)})),a.userAgent.transport.on("switchBackProxy",(()=>{console.log("switching back to primary outbound proxy"),a.userAgent.transport.reconnect(!0)})),a.userAgent.transport.on("closed",(()=>{console.log("WebSocket closed.")})),a.userAgent.transport.on("transportError",(()=>{console.log("WebSocket transportError occured")})),a.userAgent.transport.on("wsConnectionError",(()=>{console.log("WebSocket wsConnectionError occured")})),a}function P(e){if(w=!1,console.log("EVENT: Invite",e.request),console.log("To",e.request.to.displayName,e.request.to.friendlyName),console.log("From",e.request.from.displayName,e.request.from.friendlyName),e.request.headers["Alert-Info"]&&"Auto Answer"===e.request.headers["Alert-Info"][0].raw)e.accept().then((()=>{A(e)})).catch((e=>{console.error("Accept failed",e.stack||e)}));else{const o=S(f).modal({backdrop:"static"});o.find(".answer").on("click",(()=>{o.find(".before-answer").css("display","none"),o.find(".answered").css("display",""),e.accept().then((()=>{o.modal("hide"),A(e)})).catch((e=>{console.error("Accept failed",e.stack||e)}))})),o.find(".decline").on("click",(()=>{e.reject(),o.modal("hide")})),o.find(".toVoicemail").on("click",(()=>{e.toVoicemail(),o.modal("hide")})),o.find(".forward-form").on("submit",(n=>{n.preventDefault(),n.stopPropagation(),e.forward(o.find("input[name=forward]").val().trim()).then((()=>{console.log("Forwarded"),o.modal("hide")})).catch((e=>{console.error("Forward failed",e.stack||e)}))})),o.find(".reply-form").on("submit",(n=>{n.preventDefault(),n.stopPropagation(),e.replyWithMessage({replyType:0,replyText:o.find("input[name=reply]").val()}).then((()=>{console.log("Replied"),o.modal("hide")})).catch((e=>{console.error("Reply failed",e.stack||e)}))})),e.on("rejected",(()=>{o.modal("hide")}))}}function A(e){console.log("EVENT: Accepted",e.request),console.log("To",e.request.to.displayName,e.request.to.friendlyName),console.log("From",e.request.from.displayName,e.request.from.friendlyName);const o=S(h).modal(),n=o.find(".info").eq(0),t=o.find("input[name=dtmf]").eq(0),l=o.find("input[name=transfer]").eq(0),i=o.find("input[name=flip]").eq(0),s=(o.find("input[name=conference]").eq(0),setInterval((()=>{const o=e.startTime?Math.round((Date.now()-e.startTime)/1e3)+"s":"Ringing";n.text("time: "+o+"\nstartTime: "+JSON.stringify(e.startTime,null,2)+"\n")}),1e3));function d(){clearInterval(s),o.modal("hide")}o.find(".increase-volume").on("click",(()=>{e.userAgent.audioHelper.setVolume((null!==e.userAgent.audioHelper.volume?e.userAgent.audioHelper.volume:.5)+.1)})),o.find(".decrease-volume").on("click",(()=>{e.userAgent.audioHelper.setVolume((null!==e.userAgent.audioHelper.volume?e.userAgent.audioHelper.volume:.5)-.1)})),o.find(".mute").on("click",(()=>{e.mute()})),o.find(".unmute").on("click",(()=>{e.unmute()})),o.find(".hold").on("click",(()=>{e.hold().then((()=>{console.log("Holding")})).catch((e=>{console.error("Holding failed",e.stack||e)}))})),o.find(".unhold").on("click",(()=>{e.unhold().then((()=>{console.log("UnHolding")})).catch((e=>{console.error("UnHolding failed",e.stack||e)}))})),o.find(".startRecord").on("click",(()=>{e.startRecord().then((()=>{console.log("Recording Started")})).catch((e=>{console.error("Recording Start failed",e.stack||e)}))})),o.find(".stopRecord").on("click",(()=>{e.stopRecord().then((()=>{console.log("Recording Stopped")})).catch((e=>{console.error("Recording Stop failed",e.stack||e)}))})),o.find(".park").on("click",(()=>{e.park().then((()=>{console.log("Parked")})).catch((e=>{console.error("Park failed",e.stack||e)}))})),o.find(".transfer-form").on("submit",(n=>{n.preventDefault(),n.stopPropagation(),e.transfer(l.val().trim()).then((()=>{console.log("Transferred"),o.modal("hide")})).catch((e=>{console.error("Transfer failed",e.stack||e)}))})),o.find(".transfer-form button.warm").on("click",(n=>{n.preventDefault(),n.stopPropagation(),e.hold().then((()=>{console.log("Placing the call on hold, initiating attended transfer");const n=e.userAgent.invite(l.val().trim());n.once("established",(()=>{console.log("New call initated. Click Complete to complete the transfer"),o.find(".transfer-form button.complete").on("click",(()=>{e.warmTransfer(n).then((()=>{console.log("Warm transfer completed")})).catch((e=>{console.error("Transfer failed",e.stack||e)}))}))}))}))})),o.find(".flip-form").on("submit",(o=>{o.preventDefault(),o.stopPropagation(),e.flip(i.val().trim()).then((()=>{console.log("Flipped")})).catch((e=>{console.error("Flip failed",e.stack||e)})),i.val("")})),o.find(".dtmf-form").on("submit",(o=>{o.preventDefault(),o.stopPropagation(),e.dtmf(t.val().trim()),t.val("")})),o.find(".startConf").on("click",(e=>{q||r.get("/restapi/v1.0/account/~/extension/~/presence?detailedTelephonyState=true").then((e=>e.json())).then((e=>{const o=e.activeCalls[0].partyId,n=e.activeCalls[0].telephonySessionId;r.post("/restapi/v1.0/account/~/telephony/conference",{}).then((e=>e.json())).then((e=>(y=e.session.id,e.session.voiceCallToken))).then((e=>{!function(e,o,n){const t=a.userAgent.invite(e,{fromNumber:c});t.on("established",(()=>{A(t),console.log("Conference call started"),function(e,o){const n="/restapi/v1.0/account/accountId/telephony/sessions/"+y+"/parties/bring-in";return r.post(n,{telephonySessionId:e,partyId:o})}(n,o).then((e=>e.json())).then((e=>{console.log("Adding call to conference succesful",e)})).catch((e=>{console.error("Conference call failed",e.stack||e)}))}))}(e,o,n),q=!0}))}))})),o.find(".hangup").on("click",(()=>{e.dispose()})),e.on("established",(()=>{console.log("Event: Established"),function(e){const o=w?"Outbound":"Inbound",n={id:"",from:"",to:"",direction:"",sipData:{toTag:"",fromTag:""}};n.from=e.request.from.uri.user,n.to=e.request.to.uri.user,n.direction=o,n.id=e.dialog.id.callId,n.sipData.fromTag=e.dialog.remoteTag,n.sipData.toTag=e.dialog.localTag,localStorage.getItem("activeCallInfo")||localStorage.setItem("activeCallInfo",JSON.stringify(n))}(e)})),e.on("progress",(()=>{console.log("Event: Progress")})),e.on("rejected",(()=>{console.log("Event: Rejected"),d()})),e.on("failed",(function(){console.log("Event: Failed",arguments),d()})),e.on("terminated",(()=>{console.log("Event: Terminated"),localStorage.setItem("activeCallInfo",""),d()})),e.on("cancel",(()=>{console.log("Event: Cancel"),d()})),e.on("refer",(()=>{console.log("Event: Refer"),d()})),e.on("replaced",(o=>{console.log("Event: Replaced: old session",e,"has been replaced with",o),d(),A(o)})),e.on("dtmf",(()=>{console.log("Event: DTMF")})),e.on("muted",(()=>{console.log("Event: Muted")})),e.on("unmuted",(()=>{console.log("Event: Unmuted")})),e.on("connecting",(()=>{console.log("Event: Connecting")})),e.on("bye",(()=>{console.log("Event: Bye"),d()}))}let q=!1;function E(){const e=S(p),o=e.find("input[name=number]").eq(0),n=e.find("input[name=homeCountry]").eq(0),t=e.find(".username").eq(0),l=e.find(".logout").eq(0),r=e.find(".switch").eq(0);t.html("<dl><dt>Contact</dt><dd>"+s.contact.firstName+" "+s.contact.lastName+"</dd><dt>Company</dt><dd>"+(s.contact.company||"?")+"</dd><dt>From Phone Number</dt><dd>"+c+(""===d?"":"*"+d)+"</dd></dl>"),l.on("click",(e=>{a.userAgent.unregister(),e.preventDefault(),location.reload()})),r.on("click",(e=>{!function(){const e=JSON.parse(localStorage.getItem("activeCallInfo"));console.log("Switching active call to current tab: ",e),A(a.userAgent.switchFrom(e))}()})),o.val(localStorage.getItem("webPhoneLastNumber")||""),e.on("submit",(e=>{var t,l;e.preventDefault(),e.stopPropagation(),localStorage.setItem("webPhoneLastNumber",o.val()||""),t=o.val(),l=n.val(),w=!0,l=l||s&&s.regionalSettings&&s.regionalSettings.homeCountry&&s.regionalSettings.homeCountry.id||null,A(a.userAgent.invite(t,{fromNumber:c,homeCountryId:l}))})),g.empty().append(e)}!function(){const o=S(u),n=S(m),l=n.find("input[name=server]").eq(0),a=n.find("input[name=clientId]").eq(0),s=n.find("input[name=clientSecret]").eq(0),p=o.find("input[name=username]").eq(0),f=o.find("input[name=extension]").eq(0),h=o.find("input[name=password]").eq(0),v=n.find("select[name=logLevel]").eq(0);l.val(localStorage.getItem("webPhoneServer")||e.server.sandbox),a.val(localStorage.getItem("webPhoneclientId")||""),s.val(localStorage.getItem("webPhoneclientSecret")||""),p.val(localStorage.getItem("webPhoneLogin")||""),f.val(localStorage.getItem("webPhoneExtension")||""),h.val(localStorage.getItem("webPhonePassword")||""),v.val(localStorage.getItem("webPhoneLogLevel")||i),o.on("submit",(o=>{var n,i,g,u,m,b,w;console.log("Normal Flow"),o.preventDefault(),o.stopPropagation(),n=l.val(),i=a.val(),g=s.val(),u=p.val(),m=f.val(),b=h.val(),w=v.val(),t=new e({clientId:i,clientSecret:g,server:n}),r=t.platform(),c=u,d=m,c&&(c=c.match(/^[+1]/)?c:"1"+c,c=c.replace(/\W/g,"")),r.login({username:c,extension:m||null,password:b}).then((()=>k(n,i,g,c,m,b,w))).catch((e=>{console.error(e.stack||e)}))})),n.on("submit",(o=>{console.log("Authorized Flow"),o.preventDefault(),o.stopPropagation(),function(o,n,l,a){const i=decodeURIComponent(window.location.href.split("login",1)+"callback.html");console.log("The redirect uri value :",i),t=new e({clientId:n,clientSecret:l,server:o,redirectUri:i}),r=t.platform();const c=r.loginUrl();r.loginWindow({url:c}).then(r.login.bind(r)).then((()=>k(o,n,l,"","","",a))).catch((e=>{console.error(e.stack||e)}))}(l.val(),a.val(),s.val(),v.val())})),g.empty().append(n).append(o)}()}))},"ringcentral-web-phone":e=>{"use strict";e.exports=void 0},"?8131":()=>{},"?3fc0":()=>{},"?f9d4":()=>{},"?7a28":()=>{},"?ed1b":()=>{},"?d17e":()=>{}},n={};function t(e){var l=n[e];if(void 0!==l)return l.exports;var r=n[e]={id:e,loaded:!1,exports:{}};return o[e].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}t.m=o,e=[],t.O=(o,n,l,r)=>{if(!n){var a=1/0;for(d=0;d<e.length;d++){for(var[n,l,r]=e[d],i=!0,c=0;c<n.length;c++)(!1&r||a>=r)&&Object.keys(t.O).every((e=>t.O[e](n[c])))?n.splice(c--,1):(i=!1,r<a&&(a=r));if(i){e.splice(d--,1);var s=l();void 0!==s&&(o=s)}}return o}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[n,l,r]},t.d=(e,o)=>{for(var n in o)t.o(o,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),t.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={demo:0};t.O.j=o=>0===e[o];var o=(o,n)=>{var l,r,[a,i,c]=n,s=0;if(a.some((o=>0!==e[o]))){for(l in i)t.o(i,l)&&(t.m[l]=i[l]);if(c)var d=c(t)}for(o&&o(n);s<a.length;s++)r=a[s],t.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return t.O(d)},n=self.webpackChunkringcentral_web_phone=self.webpackChunkringcentral_web_phone||[];n.forEach(o.bind(null,0)),n.push=o.bind(null,n.push.bind(n))})();var l=t.O(void 0,["demoVendor"],(()=>t("./demo/index.js")));l=t.O(l)})();
//# sourceMappingURL=demo.js.map